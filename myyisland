-- enjoy this chatgpt generated script
pcall(function()
	if setclipboard then setclipboard('https://scriptsrbx.com') end
end)

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
	Name = "My Island Auto Farm | ScriptsRBX",
	LoadingTitle = "ScriptsRBX.com Auto Farm",
	LoadingSubtitle = "My Island Auto Farm",
	Theme = "Default",
	ShowText = "Auto Farm GUI",
	ToggleUIKeybind = "K",
	KeySystem = false,
})
local Tab = Window:CreateTab("Main", 4483362458)

-- ===================== Auto Farm Logic =====================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")

local REMFolder = ReplicatedStorage:WaitForChild("REM")

local Running = false
local AutoTask = nil
local RemotePool = {} -- active working remotes
local RemoteIndex = 1
local function getPlot()
	local id = LocalPlayer:GetAttribute("OwnedPlot") or LocalPlayer:GetAttribute("Plot")
	if not id then return nil end
	local plots = Workspace:WaitForChild("Places"):WaitForChild("World"):WaitForChild("Plots")
	return plots:FindFirstChild(tostring(id))
end

local function getMaterialModels()
	local list = {}
	local plot = getPlot()
	if not plot then return list end
	for _, tile in ipairs(plot:GetChildren()) do
		if tile:IsA("Model") then
			for _, m in ipairs(tile:GetChildren()) do
				if m:IsA("Model") and m:GetAttribute("Material") then
					table.insert(list, m)
				end
			end
		end
	end
	return list
end

local function snapshot(model)
	local t = {}
	for n, v in pairs(model:GetAttributes()) do t[n] = v end
	return t
end

local function hasChanged(before, after)
	for k, v in pairs(after) do
		if before[k] ~= v then return true end
	end
	return false
end

local function refreshRemotePool()
	local sample = getMaterialModels()[1]
	if not sample then return end

	local before = snapshot(sample)
	local newPool = {}

	for _, r in ipairs(REMFolder:GetChildren()) do
		if r:IsA("RemoteEvent") then
			pcall(function()
				r:FireServer({ UUID = sample.Name })
			end)
			task.wait(0.15)
			local after = snapshot(sample)
			if hasChanged(before, after) then
				table.insert(newPool, r)
				before = snapshot(sample)
			end
		end
	end

	if #newPool > 0 then
		RemotePool = newPool
		RemoteIndex = 1
		else
		warn("No Remote found")
	end
end

local function getNextRemote()
	if #RemotePool == 0 then
		refreshRemotePool()
	end
	if #RemotePool == 0 then return nil end

	RemoteIndex += 1
	if RemoteIndex > #RemotePool then RemoteIndex = 1 end
	return RemotePool[RemoteIndex]
end

local function harvestLoop()
	local plot = getPlot()
	if not plot then
		return
	end

	while Running do
		if #RemotePool == 0 then refreshRemotePool() end

		for _, tile in ipairs(plot:GetChildren()) do
			if tile:IsA("Model") then
				for _, obj in ipairs(tile:GetChildren()) do
					if obj:IsA("Model") and obj:GetAttribute("Material") then
						local remote = getNextRemote()
						if remote then
							pcall(function()
								remote:FireServer({ UUID = obj.Name })
							end)
						end
					end
				end
			end
		end

		task.wait(0.08) -- faster loop, adaptive
	end
end

local function startAutoFarm()
	if Running then return end
	Running = true
	refreshRemotePool()
	AutoTask = task.spawn(harvestLoop)
end

local function stopAutoFarm()
	if not Running then return end
	Running = false
	if AutoTask then task.cancel(AutoTask) AutoTask = nil end
end
local AutoOrbRunning = false
local AutoOrbTask = nil
local MaterialList = { "Diamond", "Gold", "Obsidian", "Stardust", "Uranium" }

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function teleportOrbsOnce()
	local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local Root = Character:FindFirstChild("HumanoidRootPart")
	if not Root then return end

	local moved = 0
	for _, obj in ipairs(workspace:GetChildren()) do
		if obj:IsA("BasePart") then
			for _, matName in ipairs(MaterialList) do
				if obj.Name == matName then
					obj.Anchored = false
					obj.CanCollide = false
					obj.Position = Root.Position + Vector3.new(math.random(-5,5), 1, math.random(-5,5))
					moved += 1
					break
				end
			end
		end
	end

	if moved > 0 then
	end
end

local function startAutoOrbs()
	if AutoOrbRunning then return end
	AutoOrbRunning = true
	AutoOrbTask = task.spawn(function()
		while AutoOrbRunning do
			teleportOrbsOnce()
			task.wait(0.5) -- scan rate; lower = faster updates
		end
	end)
end

local function stopAutoOrbs()
	if not AutoOrbRunning then return end
	AutoOrbRunning = false
	if AutoOrbTask then
		task.cancel(AutoOrbTask)
		AutoOrbTask = nil
	end
end
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Humanoid
local DesiredWalkSpeed = 16
local WalkSpeedConnection

local function updateHumanoid()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	Humanoid = char:WaitForChild("Humanoid")

	-- restart enforcement loop on new character
	if WalkSpeedConnection then WalkSpeedConnection:Disconnect() end
	WalkSpeedConnection = RunService.Heartbeat:Connect(function()
		if Humanoid and Humanoid.WalkSpeed ~= DesiredWalkSpeed then
			Humanoid.WalkSpeed = DesiredWalkSpeed
		end
	end)
end

updateHumanoid()
LocalPlayer.CharacterAdded:Connect(updateHumanoid)

local AntiIdle = true
local AntiIdleConn

local function enableAntiIdle()
    local GC = getconnections or get_signal_cons
    if GC then
        for _,v in pairs(GC(Players.LocalPlayer.Idled)) do
            if v.Disable then
                v:Disable()
            elseif v.Disconnect then
                v:Disconnect()
            end
        end
        print("[SRBX] Anti Idle: connections disabled")
    else
        local VirtualUser = cloneref(game:GetService("VirtualUser"))
        AntiIdleConn = Players.LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
            print("[SRBX] Anti Idle: VirtualUser click")
        end)
    end
end

local function disableAntiIdle()
    if AntiIdleConn then
        AntiIdleConn:Disconnect()
        AntiIdleConn = nil
    end
end

-- Enable by default on script start
enableAntiIdle()

Tab:CreateToggle({
	Name = "Auto Harvet Aura",
	CurrentValue = false,
	Flag = "AutoFarmToggle",
	Callback = function(v)
		task.spawn(function()
			if v then startAutoFarm() else stopAutoFarm() end
		end)
	end
})

Tab:CreateToggle({
	Name = "Auto Teleport Material Orbs",
	CurrentValue = false,
	Flag = "AutoOrbToggle",
	Callback = function(state)
		task.spawn(function()
			if state then
				startAutoOrbs()
			else
				stopAutoOrbs()
			end
		end)
	end
})

Tab:CreateSlider({
	Name = "Walk Speed",
	Range = {16, 250}, -- adjustable max speed
	Increment = 1,
	Suffix = "Speed",
	CurrentValue = DesiredWalkSpeed,
	Flag = "WalkSpeedSlider",
	Callback = function(value)
		DesiredWalkSpeed = value
		if Humanoid then
			Humanoid.WalkSpeed = value
		end
	end
})

-- ===================== Teleports Tab (Model-Safe) =====================

local TeleportTab = Window:CreateTab("Teleports", 4483362458)

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function safeTeleport(target)
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local root = char:WaitForChild("HumanoidRootPart")

	if typeof(target) == "Instance" then
		local cf

		-- Determine teleport position based on instance type
		if target:IsA("BasePart") then
			cf = target.CFrame
		elseif target:IsA("Model") then
			if target.PrimaryPart then
				cf = target.PrimaryPart.CFrame
			else
				cf = target:GetPivot()
			end
		end

		if cf then
			root.CFrame = cf + Vector3.new(0, 2, 0)
			print("[Teleport] ✅ Teleported to:", target:GetFullName())
			return
		end
	end

	warn("[Teleport] ⚠️ Invalid teleport target.")
end

-- === 1. Center Island Crafting Stand ===
TeleportTab:CreateButton({
	Name = "Center Island: Crafting Stand",
	Callback = function()
		local target = workspace.Places.World.CenterIsland:FindFirstChild("CraftingStand")
		if target then
			safeTeleport(target)
		else
			warn("[Teleport] CraftingStand not found.")
		end
	end
})

-- === 2. Ancient Island: Ancient Table ===
TeleportTab:CreateButton({
	Name = "Ancient Island: Ancient Table",
	Callback = function()
		local target = workspace.Places.World.AncientIsland:FindFirstChild("AncientTable")
		if target then
			safeTeleport(target)
		else
			warn("[Teleport] AncientTable not found.")
		end
	end
})

-- === 3. Persistent Coil: Gravity ===
TeleportTab:CreateButton({
	Name = "Persistent Coil: Gravity",
	Callback = function()
		local target = workspace.Places.World.PersistentCoils:FindFirstChild("Gravity")
		if target then
			safeTeleport(target)
		else
			warn("[Teleport] Gravity Coil not found.")
		end
	end
})

-- === 4. Persistent Coil: Speed ===
TeleportTab:CreateButton({
	Name = "Persistent Coil: Speed",
	Callback = function()
		local target = workspace.Places.World.PersistentCoils:FindFirstChild("Speed")
		if target then
			safeTeleport(target)
		else
			warn("[Teleport] Speed Coil not found.")
		end
	end
})

local MiscTab  = Window:CreateTab('Misc', 4483362458)


MiscTab:CreateToggle({
    Name = "Anti Idle (Prevent AFK Kick)",
    CurrentValue = true,
    Callback = function(on)
        AntiIdle = on
        if on then
            enableAntiIdle()
            firesignal(Notification.OnClientEvent, {
                Text = "Anti Idle Enabled",
                Gradient = Color3.fromRGB(0,255,0)
            })
        else
            disableAntiIdle()
            firesignal(Notification.OnClientEvent, {
                Text = "Anti Idle Disabled",
                Gradient = Color3.fromRGB(255,0,0)
            })
        end
    end,
})
